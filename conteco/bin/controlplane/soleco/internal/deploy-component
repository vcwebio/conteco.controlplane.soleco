#!/usr/bin/env bash
method="$1"
imageName="$2"
component="$3"

# local and global network prefix
. set-config $imageName $component

# create module overlay network - global
if [[ "$method" == *"down"* ]] ; then
  executionplane --silent docker network rm ${CONTECO_NETWORKLOCAL}_overlay
fi
if [[ "$method" == *"up"* ]] ; then
  executionplane --silent docker network create -d overlay ${CONTECO_NETWORKGLOBAL}_overlay
  executionplane --silent docker network create -d overlay ${CONTECO_NETWORKLOCAL}_overlay
fi

# create module package volumes - on all nodes
echo "controlplane-service deploy local-$method $component $imageName"
controlplane-service deploy "local-$method" "$component" "$imageName"
