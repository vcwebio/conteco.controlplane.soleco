#!/usr/bin/env bash
(
	export PATH="$CONTECO_EXECUTIONPLANE_APIINTERNALPATH_SOLECO"
	. executionplane-invoke "$0 $@"
	imageName="${@: -1}"
	. invoke-script $imageName environment

	if [[ $# -gt 2 ]] ; then
		component="${2}/"
	fi

	command=$1
	shift
	case $command in
		all)
			config build $@
			if [[  " backup " != *"$CONTECO_TYPE"* ]] ; then
				config module $@
				config component $@
				config deploy $@
				config volume $@
			fi
		;;
		component)
			config-component $imageName "soleco/${component}"
			descendant "$imageName|soleco/|$component" config component
		;;
		deploy)
			config-deploy $imageName "soleco/${component}"
			descendant "$imageName|soleco/|$component" config deploy
		;;
		module)
			config-module $imageName "soleco/${component}"
			descendant "$imageName|soleco/|$component" config module
		;;
		volume)
			config-volume $imageName "soleco/${component}"
			descendant "$imageName|soleco/|$component" config volume
		;;
		*)
			.base config $command $@
    ;;
	esac
  executionplane-complete
)
